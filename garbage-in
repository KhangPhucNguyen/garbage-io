#!/bin/bash

. garbage-conf

move_bg(){
    thing="$1"
    destination="$2"
    mv "$thing" "$destination"
    find "$destination" -type f -exec touch {} \;
}

for arg in "$@"
do
    thing="$(readlink -f "$arg")"
    dir=$(dirname "$thing")
    name=$(basename "$thing")

    # Make this thing invisible
    new_name=".$name.$stamp-$(date +'%Y-%m-%d_%H-%M-%S')"
    new_thing="$dir/$new_name"
    mv "$thing" "$new_thing"

    # Move this thing to the archive
    dest_dir="$ar_dir$dir"
    destination="$dest_dir/$new_name"
    mkdir -p "$dest_dir"
    move_bg "$new_thing" "$destination" &
done
